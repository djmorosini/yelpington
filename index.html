<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Yelpington App</title>
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" media="screen" href="main.css" />
  <script src="main.js"></script> -->
    <script src="yelpington.js"></script>
    <link rel="stylesheet" href="yelpington.css" type="text/css">
    <link rel="shortcut icon" href="files/yIcon.ico">
    <link href="https://fonts.googleapis.com/css?family=PT+Serif" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
        crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
        crossorigin=""></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>

<body>

    <a href="/" id="home">Home</a>
    <div id="pageHead">
        <header>Yelpington‚ù¢</header>
    </div>

    <h1 id="title"></h1>
    <div id="menu"></div>
    <div id="layout">
        <div id="wrapper">
            <div id="addressDiv"></div>
            <div id="phone"></div>
            <div id="hours"></div>
            <div id="notes"></div>
        </div>
        <div id="map"></div>
    </div>
    <div id="directory">
        <nav id="navBar"></nav>
        <div id="frontMap"></div>
    </div>

    <script>

        let name = document.location.pathname.slice(1)

        if (!name || name == "all") {

            let title = document.getElementById("title")
            title.textContent = "Restaurant Directory üçó"

            let frontMapDiv = document.getElementById("frontMap")
            frontMapDiv.setAttribute("style", "height: 400px; width: 600px; border: 1px solid black; float: right;");

            let mymap = L.map('frontMap').setView([44.4779, -73.2166], 16);

            L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
                attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery ¬© <a href="https://www.mapbox.com/">Mapbox</a>',
                maxZoom: 18,
                id: 'mapbox.streets',
                accessToken: 'pk.eyJ1IjoiZGptb3Jvc2luaSIsImEiOiJjamphMng3a20wN2xwM3BxaDl1b2hlamNjIn0.dd7Bj-cAdxOMnaS9t01gpw'
            }).addTo(mymap);

            function addMapMarker(markerID, mapLat, mapLon, restaurantID, restaurantName) {
                markerID = L.marker([mapLat, mapLon]).addTo(mymap);
                markerID.bindPopup("<a href='/" + restaurantID + "'>" + restaurantName + "</a>")
            }

            fetchAllThenPopulateListAndMap()

        } else {

            let wrapDiv = document.getElementById("wrapper")
            wrapDiv.setAttribute("style", "min-height: 450px; width: 650px; min-width: 200px; border: 1px solid black; background-color: rgba(255, 255, 255, 0.5); padding: 5px;")

            fetch(name + '.json')
                .then(function (response) {
                    return response.text();
                })
                .then(function (myText) {

                    data = JSON.parse(myText)

                    addPageInfo()

                })
                .then(function () {

                    let addressArray = data.address.split(" ")

                    let locationSearch = addressArray.join("+")

                    let url = "https://nominatim.openstreetmap.org/search?q=" + locationSearch + "&format=json"

                    fetch(url)
                        .then(function (response) {
                            console.log(url)
                            return response.json();
                        })
                        .then(function (myJSON) {

                            function createRestaurantMap() {
                                firstBbox = myJSON[0].boundingbox[0]
                                secondBbox = myJSON[0].boundingbox[1]
                                thirdBbox = myJSON[0].boundingbox[2]
                                fourthBbox = myJSON[0].boundingbox[3]

                                markLat = myJSON[0].lat
                                markLon = myJSON[0].lon

                                document.getElementById("map").innerHTML = "<h2>Location: </h2><br>" + '<iframe width="425" height="350" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="https://www.openstreetmap.org/export/embed.html?bbox=' + thirdBbox + "," + firstBbox + "," + fourthBbox + "," + secondBbox + '&layer=mapnik&marker=' + markLat + '%2C' + markLon + '" style="border: 1px solid black"></iframe><br/><small><a style="position: relative; bottom: 20px; left:10px; background-color:white;" href="https://www.openstreetmap.org/?mlat=44.47518&mlon=-73.21256#map=19/44.47518/-73.21256">View Larger Map</a></small>'
                            }

                            createRestaurantMap()

                        })

                });
        }
    </script>

</body>

</html>